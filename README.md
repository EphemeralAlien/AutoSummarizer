# SillyTavern 全自动总结脚本 (增强版)

这是一个为Sillytavern设计的脚本，基于酒馆助手运行。它的主要目标是通过调用 AI 自动总结长篇对话，并将摘要存入世界设定书（Lorebook），以辅助实现长期记忆和上下文管理。

本脚本是在 **默默** & **萧然** 的原始版本基础上进行修改和功能添加的。在此向原作者表示感谢。

---

## 主要功能

*   **自动总结与消息隐藏**: 当未总结的消息达到设定的阈值时，脚本会自动在后台进行总结，并隐藏已总结的旧消息，保持聊天界面的简洁。
*   **图形化设置界面**: 通过 SillyTavern 的“扩展”菜单随时打开设置面板，方便配置 API、调整总结参数和查看状态。
*   **灵活的总结策略**: 支持“小总结”和“大总结”两种模式，可为不同模式设定不同的触发间隔，脚本会自动管理对应的世界书条目。
*   **内置世界书查看与编辑**: 可以在面板中直接查看、筛选（按权重）和修改已生成的总结内容，并保存回世界书。
*   **API 兼容性**: 支持配置任何与 OpenAI API 格式兼容的服务。

## 工作流程简介

1.  **监控**: 脚本监测当前聊天中的消息数量。
2.  **触发**: 当未总结的消息数达到 `总结间隔 + 保留楼层` 的阈值时，触发总结任务。
3.  **整合与调用**: 将指定范围的聊天记录打包，连同用户设定的提示词一起发送给 AI API。
4.  **储存与更新**: 接收 AI 返回的格式化摘要，将其追加到世界设定书的专用条目中，并更新聊天界面的消息可见性。

## 安装步骤

1.  **安装脚本管理器**: 你的浏览器需要一个用户脚本管理器，推荐使用 [**Tampermonkey**](https://www.tampermonkey.net/)。
2.  **安装本脚本**:
    *   进入本仓库，找到 `全自动总结0_4_0.json` 或 `.js` 脚本文件。
    *   点击文件，然后点击页面右上角的 "Raw" 按钮。
    *   Tampermonkey 会自动弹出安装界面，点击“安装”即可。
3.  **完成**: 刷新 SillyTavern 页面，脚本即可生效。

## 使用方法

1.  **打开面板**:
    *   在 SillyTavern 界面右上角，点击三条横线的菜单按钮。
    *   在 "扩展" (Extensions) 列表中，点击 **"全自动总结"** 来打开设置面板。

2.  **核心配置 (API设置)**:
    *   这是脚本正常工作的**必要步骤**。
    *   在面板中，展开 **"API 设置"** 卡片。
    *   填入你的 **API 基础 URL** 和 **API 密钥**。
    *   点击 **"加载模型"**，然后在下拉菜单中选择一个模型。
    *   点击 **"保存配置"**。右上角的状态徽章变为绿色“已配置”即表示成功。

3.  **调整自动总结参数**:
    *   展开 **"自动总结"** 卡片。
    *   设置 **总结间隔**（N）：即每多少条消息触发一次总结。
    *   设置 **保留楼层**（X）：总结后，在聊天界面额外保留的最新消息数，以确保上下文连贯。
    *   勾选 **"启用自动触发"**。
    *   点击 **"保存设置"**。

4.  **开始使用**:
    *   完成以上配置后，正常进行聊天即可。脚本会在满足条件时自动在后台工作。

## 致谢

本脚本的开发离不开原始作者 **默默** 与 **萧然** 的出色工作，大部分核心总结逻辑均源于他们的版本。本版本主要是在UI、工作流自动化和用户体验上进行了重构和改进。
